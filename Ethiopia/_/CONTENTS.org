#+title: Contents

Brief table of contents and todo list.

* Files in Ethiopia/_/
** DONE ethiopia.py
Contains code common to different Ethiopia rounds
** TODO food_items.org
Should have columns for each year, with "Preferred Labels" and "Aggregate Labels".   Labels for different years:
#+begin_src python :results output :tangle /tmp/test.py
from lsms.tools import from_dta
import dvc.api
import pyreadstat
import pandas as pd
from cfe.df_utils import df_to_orgtbl

Country = 'Ethiopia'

fs = dvc.api.DVCFileSystem('./')

itemlabel_location = {'2011-12':('sect5a_hh_w1.dta','hh_s5aq00'),
                      '2013-14':('sect5a_hh_w2.dta','hh_s5aq00'),
                      '2015-16':('sect5a_hh_w3.dta','hh_s5aq0a'),
                      '2018-19':('sect6a_hh_w4.dta','item_cd')}

itemlabels = {}
for k,v in itemlabel_location.items():
    try:
        with fs.open(f'/{Country}/{k}/Data/{v[0]}') as dta:
            df = from_dta(dta)
            itemlabels[k] = df[v[1]].value_counts().index.tolist()
    except ValueError:  # pd.io.stata can't read some versions of dta files...
        fs.get_file(f'/{Country}/{k}/Data/{v[0]}',f'/tmp/{v[0]}')
        df, meta = pyreadstat.read_dta(f'/tmp/{v[0]}')
        itemlabels[k] = list(meta.value_labels[v[1]].values())

# Build dictionary of dictionaries for matching
from collections import defaultdict
import difflib

D = defaultdict(dict)
D.update({k:{'Preferred Label':k} for k in itemlabels['2018-19']})

for wave in ['2013-14','2011-12']:
    for l in itemlabels[wave]:
        k = difflib.get_close_matches(l,itemlabels['2018-19'])
        if len(k):
            D[k[0]][wave] = l
        else:
            D[l][wave] = l

df = pd.DataFrame(D).T

print(df_to_orgtbl(df))
#+end_src

#+results:

| Preferred Label               | 2018-19                                            | 2013-14       | 2011-12       |
|-------------------------------+----------------------------------------------------+---------------+---------------|
| Teff                          | 101. Teff                                          | Teff          | Teff          |
| Avocado                       | 505. Avocado                                       | ---           | ---           |
| Milk                          | 705. Milk                                          | Milk          | Milk          |
| Fish                          | 704. Fish                                          | ---           | ---           |
| Poultry                       | 703. Poultry                                       | ---           | ---           |
| Beef                          | 702. Beef                                          | ---           | ---           |
| Goat & mutton meat            | 701. Goat & mutton meat                            | ---           | ---           |
| Other tuber or stem           | 610. Other tuber or stem (SPECIFY)                 | ---           | ---           |
| Beetroot                      | 609. Beetroot                                      | ---           | ---           |
| Carrot                        | 608. Carrot                                        | ---           | ---           |
| Godere                        | 607. Godere                                        | ---           | ---           |
| Cassava                       | 606. Cassava                                       | ---           | ---           |
| Boye/Yam                      | 605. Boye/Yam                                      | ---           | ---           |
| Sweet potato                  | 604. Sweet potato                                  | ---           | ---           |
| Bula                          | 603. Bula                                          | Bula          | ---           |
| Kocho                         | 602. Kocho                                         | Kocho         | Kocho         |
| Potato                        | 601. Potato                                        | Potato        | Potato        |
| Cheese                        | 706. Cheese                                        | Cheese        | Cheese        |
| Butter/ghee                   | 707. Butter/ghee                                   | ---           | ---           |
| Oils (processed)              | 708. Oils (processed)                              | ---           | ---           |
| Beer                          | 804. Beer                                          | ---           | ---           |
| Pasta/Macaroni                | 903. Pasta/Maccaroni                               | ---           | ---           |
| Bread/biscuit                 | 902. purchased bread/biscuit                       | ---           | ---           |
| Injera                        | 901. purchased Injera                              | ---           | ---           |
| Hops (gesho)                  | 807. Hops (gesho)                                  | ---           | ---           |
| Chat/Kat                      | 806. Chat / Kat                                    | Chat / Kat    | Chat / Kat    |
| Tella                         | 805. Tella                                         | ---           | ---           |
| Soda                          | 803. Soft drinks/Soda                              | ---           | ---           |
| Eggs                          | 709. Eggs                                          | Eggs          | Eggs          |
| Tea                           | 802. Tea                                           | ---           | ---           |
| Coffee                        | 801. Coffee                                        | Coffee        | Coffee        |
| Other condiments              | 713. Other condiments                              | ---           | ---           |
| Salt                          | 712. Salt                                          | Salt          | Salt          |
| Honey                         | 711. Honey, natural                                | ---           | ---           |
| Sugar                         | 710. Sugar                                         | Sugar         | Sugar         |
| Other fruit                   | 506. Other fruit (SPECIFY) ____                    | ---           | ---           |
| Papaya                        | 504. Papaya                                        | ---           | ---           |
| Wheat                         | 102. Wheat (Incl. Flour factory product)           | Wheat         | Wheat         |
| Mango                         | 503. Mango                                         | ---           | ---           |
| Fenugreek                     | 208. Fenugreek                                     | ---           | ---           |
| Vetch                         | 207. Vetch                                         | ---           | ---           |
| Ground nuts                   | 206. Ground nuts                                   | ---           | ---           |
| Haricot Beans                 | 205. Haricot Beans                                 | Haricot Beans | Haricot Beans |
| Lentils                       | 204. Lentils                                       | Lentils       | Lentils       |
| Field Pea                     | 203. Field Pea                                     | Field Pea     | Field Pea     |
| Chick Pea                     | 202. Chick Pea                                     | Chick Pea     | Chick Pea     |
| Horsebeans                    | 201. Horsebeans                                    | Horsebeans    | Horsebeans    |
| Other cereal                  | 109. Other cereal (SPECIFY)                        | ---           | ---           |
| Oats                          | 108. Oats                                          | ---           | ---           |
| Rice                          | 107. Rice                                          | ---           | ---           |
| Millet                        | 106. Millet                                        | Millet        | Millet        |
| Sorghum                       | 105. Sorghum                                       | Sorghum       | Sorghum       |
| Maize                         | 104. Maize                                         | Maize         | Maize         |
| Barley                        | 103. Barley (Incl. Beso: roasted & milled barely)  | Barley        | Barley        |
| Mung Bean                     | 209. mung bean                                     | ---           | ---           |
| Shiro                         | 210. Processed pulses (Shiro)                      | ---           | ---           |
| Other pulse or nut            | 211. Other pulse or nut (SPECIFY)                  | ---           | ---           |
| Leafy Greens                  | 404. kale, cabbage, Pumpikn Leaf, Lettuce, spinach | ---           | ---           |
| Orange                        | 502. Orange                                        | ---           | ---           |
| Banana                        | 501. Banana                                        | Banana        | Banana        |
| Other vegetable               | 408. Other vegetable (SPECIFY)                     | ---           | ---           |
| Moringa/Shiferaw/Halloka      | 407. Moringa/Shiferaw/Halloka                      | ---           | ---           |
| Garlic                        | 406. Garlic                                        | ---           | ---           |
| Tomato                        | 405. Tomato                                        | ---           | ---           |
| Berbere                       | 403. Red pepper (Processed pepper (Berbere))       | ---           | ---           |
| Niger Seed                    | 301. Niger Seed                                    | Niger Seed    | Niger Seed    |
| Kariya                        | 402. Green chili pepper (kariya)                   | ---           | ---           |
| Onion                         | 401. Onion                                         | Onion         | Onion         |
| Other seed                    | 305. Other seed (SPECIFY)                          | ---           | ---           |
| Sun Flower                    | 304. Sun Flower                                    | ---           | ---           |
| SESAME                        | 303. SESAME                                        | ---           | ---           |
| Linseed                       | 302. Linseed                                       | Linseed       | Linseed       |
| Other purchased prepared food | 904. Other purchased prepared food                 | ---           | ---           |
| Meat                          | ---                                                | Meat          | Meat          |




** DONE conversion_to_kgs.json
CLOSED: [2023-03-03 Fri 11:26]
This comes from data in =Ethiopia/2015-16/Data/=
#+begin_src python
import dvc.api
from lsms.tools import from_dta
import json

with dvc.api.open('../2015-16/Data/Food_CF_Wave3.dta',mode='rb') as dta:
    df = from_dta(dta)

foo=df.groupby('unit_cd')['mean_cf_nat'].median().to_dict()

with open('conversion_to_kgs.json','w') as f:
    json.dump({s.split('. ')[1]:v for s,v in foo.items()},f)

#+end_src

#+results:
: None
** TODO Food Conversion Table
See https://www.fao.org/3/X6877E/X6877E00.htm

* Files in Ethiopia/<SOMEYEAR>/_/
** DONE household_characteristics.py
CLOSED: [2023-03-03 Fri 11:26]
** DONE food_acquired.py
CLOSED: [2023-03-03 Fri 11:26]
