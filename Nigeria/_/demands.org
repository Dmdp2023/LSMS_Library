* Nigeria LSMS
  We use tools from =cfe.input_files= to build dataframes below.
  Note that each round actually collects data twice; once (third
  quarter) after harvest, and later after planting.

  We divide Nigeria into markets corresponding to one of six zones:
  | 1 | North central |
  | 2 | North east    |
  | 3 | North west    |
  | 4 | South east    |
  | 5 | South south   |
  | 6 | South west    |
** Constructing Household Characteristics
#+name: VARS_Nigeria
| t      | Output  | File                                      | Grouping  | Mapping                                                      |
|--------+---------+-------------------------------------------+-----------+--------------------------------------------------------------|
| 2010Q3 | M 0-3   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==1)    |
| 2010Q3 | M 4-8   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==1)    |
| 2010Q3 | M 9-13  | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==1)   |
| 2010Q3 | M 14-18 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==1)  |
| 2010Q3 | M 19-30 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==1) |
| 2010Q3 | M 31-50 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==1)  |
| 2010Q3 | M 51+   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==1)                  |
| 2010Q3 | F 0-3   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==2)    |
| 2010Q3 | F 4-8   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==2)    |
| 2010Q3 | F 9-13  | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==2)   |
| 2010Q3 | F 14-18 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==2)  |
| 2010Q3 | F 19-30 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==2) |
| 2010Q3 | F 31-50 | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==2)  |
| 2010Q3 | F 51+   | Nigeria/2010-11/Data/sect1_harvestw1.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==2)                  |
| 2012Q3 | M 0-3   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==1)    |
| 2012Q3 | M 4-8   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==1)    |
| 2012Q3 | M 9-13  | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==1)   |
| 2012Q3 | M 14-18 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==1)  |
| 2012Q3 | M 19-30 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==1) |
| 2012Q3 | M 31-50 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==1)  |
| 2012Q3 | M 51+   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==1)                  |
| 2012Q3 | F 0-3   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==2)    |
| 2012Q3 | F 4-8   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==2)    |
| 2012Q3 | F 9-13  | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==2)   |
| 2012Q3 | F 14-18 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==2)  |
| 2012Q3 | F 19-30 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==2) |
| 2012Q3 | F 31-50 | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==2)  |
| 2012Q3 | F 51+   | Nigeria/2012-13/Data/sect1_harvestw2.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==2)                  |
| 2015Q3 | M 0-3   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==1)    |
| 2015Q3 | M 4-8   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==1)    |
| 2015Q3 | M 9-13  | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==1)   |
| 2015Q3 | M 14-18 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==1)  |
| 2015Q3 | M 19-30 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==1) |
| 2015Q3 | M 31-50 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==1)  |
| 2015Q3 | M 51+   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==1)                  |
| 2015Q3 | F 0-3   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==2)    |
| 2015Q3 | F 4-8   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==2)    |
| 2015Q3 | F 9-13  | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==2)   |
| 2015Q3 | F 14-18 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==2)  |
| 2015Q3 | F 19-30 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==2) |
| 2015Q3 | F 31-50 | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==2)  |
| 2015Q3 | F 51+   | Nigeria/2015-16/Data/sect1_harvestw3.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==2)                  |
| 2018Q3 | M 0-3   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==1)    |
| 2018Q3 | M 4-8   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==1)    |
| 2018Q3 | M 9-13  | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==1)   |
| 2018Q3 | M 14-18 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==1)  |
| 2018Q3 | M 19-30 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==1) |
| 2018Q3 | M 31-50 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==1)  |
| 2018Q3 | M 51+   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==1)                  |
| 2018Q3 | F 0-3   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==2)    |
| 2018Q3 | F 4-8   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==2)    |
| 2018Q3 | F 9-13  | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==2)   |
| 2018Q3 | F 14-18 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==2)  |
| 2018Q3 | F 19-30 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==2) |
| 2018Q3 | F 31-50 | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==2)  |
| 2018Q3 | F 51+   | Nigeria/2018-19/Data/sect1_harvestw4.csv  | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==2)                  |
| 2011Q1 | M 0-3   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==1)    |
| 2011Q1 | M 4-8   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==1)    |
| 2011Q1 | M 9-13  | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==1)   |
| 2011Q1 | M 14-18 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==1)  |
| 2011Q1 | M 19-30 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==1) |
| 2011Q1 | M 31-50 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==1)  |
| 2011Q1 | M 51+   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==1)                  |
| 2011Q1 | F 0-3   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 0) & (x.s1q4 < 4) & (x.s1q2 ==2)    |
| 2011Q1 | F 4-8   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 4) & (x.s1q4 < 9) & (x.s1q2 ==2)    |
| 2011Q1 | F 9-13  | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 9) & (x.s1q4 < 14) & (x.s1q2 ==2)   |
| 2011Q1 | F 14-18 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 14) & (x.s1q4 < 19) & (x.s1q2 ==2)  |
| 2011Q1 | F 19-30 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 19)  & (x.s1q4 < 31) & (x.s1q2 ==2) |
| 2011Q1 | F 31-50 | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 31) & (x.s1q4 < 51) & (x.s1q2 ==2)  |
| 2011Q1 | F 51+   | Nigeria/2010-11/Data/sect1_plantingw1.csv | ('j',sum) | lambda x: 0 + (x.s1q4 >= 51) & (x.s1q2 ==2)                  |
| 2013Q1 | M 0-3   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==1)    |
| 2013Q1 | M 4-8   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==1)    |
| 2013Q1 | M 9-13  | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==1)   |
| 2013Q1 | M 14-18 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==1)  |
| 2013Q1 | M 19-30 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==1) |
| 2013Q1 | M 31-50 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==1)  |
| 2013Q1 | M 51+   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==1)                  |
| 2013Q1 | F 0-3   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==2)    |
| 2013Q1 | F 4-8   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==2)    |
| 2013Q1 | F 9-13  | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==2)   |
| 2013Q1 | F 14-18 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==2)  |
| 2013Q1 | F 19-30 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==2) |
| 2013Q1 | F 31-50 | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==2)  |
| 2013Q1 | F 51+   | Nigeria/2012-13/Data/sect1_plantingw2.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==2)                  |
| 2016Q1 | M 0-3   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==1)    |
| 2016Q1 | M 4-8   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==1)    |
| 2016Q1 | M 9-13  | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==1)   |
| 2016Q1 | M 14-18 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==1)  |
| 2016Q1 | M 19-30 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==1) |
| 2016Q1 | M 31-50 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==1)  |
| 2016Q1 | M 51+   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==1)                  |
| 2016Q1 | F 0-3   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==2)    |
| 2016Q1 | F 4-8   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==2)    |
| 2016Q1 | F 9-13  | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==2)   |
| 2016Q1 | F 14-18 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==2)  |
| 2016Q1 | F 19-30 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==2) |
| 2016Q1 | F 31-50 | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==2)  |
| 2016Q1 | F 51+   | Nigeria/2015-16/Data/sect1_plantingw3.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==2)                  |
| 2019Q1 | M 0-3   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==1)    |
| 2019Q1 | M 4-8   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==1)    |
| 2019Q1 | M 9-13  | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==1)   |
| 2019Q1 | M 14-18 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==1)  |
| 2019Q1 | M 19-30 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==1) |
| 2019Q1 | M 31-50 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==1)  |
| 2019Q1 | M 51+   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==1)                  |
| 2019Q1 | F 0-3   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 0) & (x.s1q6 < 4) & (x.s1q2 ==2)    |
| 2019Q1 | F 4-8   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 4) & (x.s1q6 < 9) & (x.s1q2 ==2)    |
| 2019Q1 | F 9-13  | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 9) & (x.s1q6 < 14) & (x.s1q2 ==2)   |
| 2019Q1 | F 14-18 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 14) & (x.s1q6 < 19) & (x.s1q2 ==2)  |
| 2019Q1 | F 19-30 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 19)  & (x.s1q6 < 31) & (x.s1q2 ==2) |
| 2019Q1 | F 31-50 | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 31) & (x.s1q6 < 51) & (x.s1q2 ==2)  |
| 2019Q1 | F 51+   | Nigeria/2018-19/Data/sect1_plantingw4.csv | ('j',sum) | lambda x: 0 + (x.s1q6 >= 51) & (x.s1q2 ==2)                  |

#+name: INDICES_Nigeria
| File                                      | j    | t      | m    |
|-------------------------------------------+------+--------+------|
| Nigeria/2010-11/Data/sect1_harvestw1.csv  | hhid | 2010Q3 | zone |
| Nigeria/2012-13/Data/sect1_harvestw2.csv  | hhid | 2012Q3 | zone |
| Nigeria/2015-16/Data/sect1_harvestw3.csv  | hhid | 2015Q3 | zone |
| Nigeria/2018-19/Data/sect1_harvestw4.csv  | hhid | 2018Q3 | zone |
| Nigeria/2010-11/Data/sect1_plantingw1.csv | hhid | 2011Q1 | zone |
| Nigeria/2012-13/Data/sect1_plantingw2.csv | hhid | 2013Q1 | zone |
| Nigeria/2015-16/Data/sect1_plantingw3.csv | hhid | 2016Q1 | zone |
| Nigeria/2018-19/Data/sect1_plantingw4.csv | hhid | 2019Q1 | zone |



#+begin_src python :var VARS=VARS_Nigeria INDICES=INDICES_Nigeria :colnames no :tangle /tmp/foo.py
from cfe.df_utils import orgtbl_to_df
from cfe.input_files import construct_df
import pandas as pd

VARS = orgtbl_to_df(VARS)
INDICES = orgtbl_to_df(INDICES).set_index('File')

df=construct_df(VARS,INDICES,dvcstream=True)
df.to_parquet('./z.parquet')
print(df.groupby(['t','m']).mean())
print(df.head())
print(len(df))
#+end_src

#+results:
#+begin_example
          M 0-3  M 4-8  M 9-13  M 14-18  ...  F 14-18  F 19-30  F 31-50  F 51+
t      m                                 ...                                  
2010Q3 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2011Q1 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2012Q3 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2013Q1 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2015Q3 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2016Q1 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2018Q3 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0
2019Q1 1      0      0       0        0  ...        0        0        0      0
       2      0      0       0        0  ...        0        0        0      0
       3      0      0       0        0  ...        0        0        0      0
       4      0      0       0        0  ...        0        0        0      0
       5      0      0       0        0  ...        0        0        0      0
       6      0      0       0        0  ...        0        0        0      0

[48 rows x 14 columns]
                M 0-3  M 4-8  M 9-13  M 14-18  ...  F 14-18  F 19-30  F 31-50  F 51+
j     t      m                                 ...                                  
10001 2010Q3 4      0      0       0        0  ...        0        0        0      0
             4      0      0       0        0  ...        0        0        0      0
             4      0      0       0        0  ...        0        0        0      0
             4      0      0       0        0  ...        0        0        0      0
             4      0      0       0        0  ...        0        0        0      0

[5 rows x 14 columns]
241078
#+end_example


** Constructing Household Expenditures
#+name: xVARS_Nigeria
| t      | Output | File                                       | Grouping | Mapping |
|--------+--------+--------------------------------------------+----------+---------|
| 2010Q3 | value  | Nigeria/2010-11/Data/sect10b_harvestw1.csv | None     | s10bq4  |
| 2012Q3 | value  | Nigeria/2012-13/Data/sect10b_harvestw2.csv | None     | s10bq4  |
| 2015Q3 | value  | Nigeria/2015-16/Data/sect10b_harvestw3.csv | None     | s10bq4  |
| 2018Q3 | value  | Nigeria/2018-19/Data/sect10b_harvestw4.csv | None     | s10bq10 |
| 2011Q1 | value  | Nigeria/2010-11/Data/sect7b_plantingw1.csv | None     | s7bq4   |
| 2013Q1 | value  | Nigeria/2012-13/Data/sect7b_plantingw2.csv | None     | s7bq4   |
| 2016Q1 | value  | Nigeria/2015-16/Data/sect7b_plantingw3.csv | None     | s7bq4   |
| 2019Q1 | value  | Nigeria/2018-19/Data/sect7b_plantingw4.csv | None     | s7bq10  |




#+name: xINDICES_Nigeria
| File                                       | i       | j    | t      | m    |
|--------------------------------------------+---------+------+--------+------|
| Nigeria/2010-11/Data/sect10b_harvestw1.csv | item_cd | hhid | 2010Q3 | zone |
| Nigeria/2012-13/Data/sect10b_harvestw2.csv | item_cd | hhid | 2012Q3 | zone |
| Nigeria/2015-16/Data/sect10b_harvestw3.csv | item_cd | hhid | 2015Q3 | zone |
| Nigeria/2018-19/Data/sect10b_harvestw4.csv | item_cd | hhid | 2018Q3 | zone |
| Nigeria/2010-11/Data/sect7b_plantingw1.csv | item_cd | hhid | 2011Q1 | zone |
| Nigeria/2012-13/Data/sect7b_plantingw2.csv | item_cd | hhid | 2013Q1 | zone |
| Nigeria/2015-16/Data/sect7b_plantingw3.csv | item_cd | hhid | 2016Q1 | zone |
| Nigeria/2018-19/Data/sect7b_plantingw4.csv | item_cd | hhid | 2019Q1 | zone |



#+name: build_expenditures
#+begin_src python :var VARS=xVARS_Nigeria INDICES=xINDICES_Nigeria  :colnames no  :tangle /tmp/foo.py
from cfe.df_utils import orgtbl_to_df
from cfe.input_files import construct_df
import pandas as pd
import numpy as np
import json

VARS = orgtbl_to_df(VARS)
INDICES = orgtbl_to_df(INDICES).set_index('File')

# Grab food labels 
with open('./food_items.json') as f:
    food_labels = json.load(f)

df=construct_df(VARS,INDICES,dvcstream=True,label_mappings=food_labels).reset_index()
df=df.pivot_table(index=['j','t','m'],columns='i',values='value',aggfunc=np.sum)


df.to_parquet('x.parquet')
#print(df.groupby('t').count())
#+end_src

#+results: build_expenditures


#+BEGIN_SRC python :noweb no-export :results output
import pandas as pd
nigeria_expenditures = pd.read_pickle("/tmp/y.pickle")
nigeria_expenditures.to_csv("~/nigeria_expenditures.csv")
print(nigeria_expenditures.head())

#+END_SRC

#+RESULTS:
: i           (Cocoyam, Spinach, etc)  Agricultural eggs  ...  Yam flour  Yam-roots
: t    j                                                  ...                      
: 2010 10001                      NaN              280.0  ...        NaN     1500.0
:      10002                      NaN              280.0  ...        NaN     1200.0
:      10003                      NaN              180.0  ...        NaN      400.0
:      10004                      NaN              180.0  ...        NaN      400.0
:      10006                      NaN                NaN  ...        NaN      400.0
: 
: [5 rows x 124 columns]


** Constructing Household Consumption
The file =consumption.csv= generated below is filtered after the fact
in order to bring cell count below five million. Removed all rows
where units were not descriptive in terms of weight (g, kg, l, ml,
etc.)

#+name: cVARS_Nigeria
|    t | Output | File                                                                | Grouping | Mapping |
|------+--------+---------------------------------------------------------------------+----------+---------|
| 2010 | value  | ../2010-11/Post Harvest Wave 1/Household/Data/sect10b_harvestw1.dta | None     | s10bq3a |
| 2012 | value  | ../2012-13/Post Harvest Wave 2/Household/Data/sect10b_harvestw2.dta | None     | s10bq3a |
| 2015 | value  | ../2015-16/Data/sect10b_harvestw3.dta                               | None     | s10bq3a |
| 2018 | value  | ../2018-19/Data/sect10b_harvestw4.dta                               | None     | s10bq9a |

#+name: cINDICES_Nigeria
| File                                                                    | i       | j    |    t | u       |
|-------------------------------------------------------------------------+---------+------+------+---------|
| ../2010-11/Post Harvest Wave 1/Household/Data/sect10b_harvestw1.dta | item_cd | hhid | 2010 | s10bq3b |
| ../2012-13/Post Harvest Wave 2/Household/Data/sect10b_harvestw2.dta | item_cd | hhid | 2012 | s10bq3b |
| ../2015-16/Data/sect10b_harvestw3.dta                               | item_cd | hhid | 2015 | s10bq3b |
| ../2018-19/Data/sect10b_harvestw4.dta                               | item_cd | hhid | 2018 | s10bq9b |

#+call: build_consumption(VARS=cVARS_Nigeria, INDICES=cINDICES_Nigeria)

#+RESULTS:

#+BEGIN_SRC python :noweb no-export :results output
import pandas as pd
import numpy as np
nigeria_consumption = pd.read_pickle("/tmp/y.pickle").reset_index()
nigeria_consumption['u'] = nigeria_consumption['u'].astype('str')
nigeria_consumption = nigeria_consumption.set_index(['t', 'j'])
nigeria_consumption.to_csv("~/nigeria_consumption.csv")
print(nigeria_consumption.head())
#+END_SRC

#+RESULTS:
: i                   u  (Cocoyam, Spinach, etc)  ...  Yam flour  Yam-roots
: t    j                                          ...                      
: 2010 10001  Kilograms                      NaN  ...        NaN       16.0
:      10001     Litres                      NaN  ...        NaN        NaN
:      10002  Kilograms                      NaN  ...        NaN       13.8
:      10002     Litres                      NaN  ...        NaN        NaN
:      10003  Kilograms                      NaN  ...        NaN        4.6
: 
: [5 rows x 125 columns]

** Constructing Household Consumption from Own Production
The file =consumption.csv= generated below is filtered after the fact
in order to bring cell count below five million. Removed all rows
where units were not descriptive in terms of weight (g, kg, l, ml,
etc.)

#+name: zVARS_Nigeria
|    t | Output | File                                       | Grouping | Mapping |
|------+--------+--------------------------------------------+----------+---------|
| 2010 | value  | Nigeria/2010-11/Data/sect10b_harvestw1.dta | None     | s10bq5a |
| 2012 | value  | Nigeria/2012-13/Data/sect10b_harvestw2.dta | None     | s10bq5a |
| 2015 | value  | Nigeria/2015-16/Data/sect10b_harvestw3.dta | None     | s10bq5a |
| 2018 | value  | Nigeria/2018-19/Data/sect10b_harvestw4.dta | None     | s10bq6a |

#+name: zINDICES_Nigeria
| File                                       | i       | j    |    t | u       |
|--------------------------------------------+---------+------+------+---------|
| Nigeria/2010-11/Data/sect10b_harvestw1.dta | item_cd | hhid | 2010 | s10bq5b |
| Nigeria/2012-13/Data/sect10b_harvestw2.dta | item_cd | hhid | 2012 | s10bq5b |
| Nigeria/2015-16/Data/sect10b_harvestw3.dta | item_cd | hhid | 2015 | s10bq5b |
| Nigeria/2018-19/Data/sect10b_harvestw4.dta | item_cd | hhid | 2018 | s10bq2b |

#+call: build_consumption(VARS=zVARS_Nigeria, INDICES=zINDICES_Nigeria)

#+RESULTS:

#+BEGIN_SRC python :noweb no-export :results output
import pandas as pd
import numpy as np
nigeria_consumption = pd.read_pickle("/tmp/y.pickle").reset_index()
nigeria_consumption['u'] = nigeria_consumption['u'].astype('str')
nigeria_consumption = nigeria_consumption.set_index(['t', 'j'])
nigeria_consumption.to_csv("~/nigeria_consumption_ownproduction.csv")
print(nigeria_consumption.head())
#+END_SRC

#+RESULTS:
: i             u (Cocoyam, Spinach, etc)  ... Yam flour Yam-roots
: t    j                                   ...                    
: 2010 10001  nan                     NaN  ...       NaN         0
:      10002  nan                     NaN  ...       NaN         0
:      10003  nan                     NaN  ...       NaN         0
:      10004  nan                     NaN  ...       NaN         0
:      10006  nan                     NaN  ...       NaN         0
: 
: [5 rows x 125 columns]

** Export to Google Sheets
#+NAME: nigeria-gsheets
| Worksheet Name     | File                          |
|--------------------+-------------------------------|
| Expenditures       | ~/nigeria_expenditures.csv    |
| HH Characteristics | ~/nigeria_characteristics.csv |

#+NAME: nigeria-gs
#+BEGIN_SRC python :noweb no-export :results output table :var gsheets=nigeria-gsheets
import pygsheets
import pandas as pd

gc = pygsheets.authorize(service_file='client_secret.json')
spreadsheet = gc.create("Nigeria", folder="1GyTb2tGIBb4nbqdWyYvVIYvZvFgl0ocM")

wksts = []
for row in gsheets:
    combine = [row[0], row[1]]
    wksts.append(combine)
    combine = []

for sheet in wksts:
    df = pd.read_csv(sheet[1])
    wks = spreadsheet.add_worksheet(sheet[0], rows=len(df), cols=(len(df.columns)))
    wks.set_dataframe(df,(1,1))

spreadsheet.del_worksheet(spreadsheet.worksheet_by_title("Sheet1"))

#+END_SRC

#+RESULTS: nigeria-gs
** Estimate Demands
#+begin_src python :tangle /tmp/demands.py
import cfe
import json
import pandas as pd
import numpy as np

# Aggregate food items
with open('./aggregate_items.json') as f:
    labels = json.load(f)['Aggregated Label']


x = pd.read_parquet('x.parquet')

x = x.rename(columns=labels).stack().groupby(['j','t','m','i']).sum().unstack('i')

z = pd.read_parquet('z.parquet')
z = z.groupby(['j','t','m']).sum()

x = x.replace(0,np.nan)

y = np.log(x)

r = cfe.Result(y=y,z=z)

# Restrict to NE region, which includes Gombe
#r = cfe.Result(y=y.xs(2,level='m',drop_level=False),z=z.xs(2,level='m',drop_level=False)) 

r.get_predicted_expenditures()
#+end_src
